#!/bin/bash
# Prevent committing files that look like secrets (simple checks)
STAGED=$(git diff --cached --name-only)
if echo "$STAGED" | grep -q "^\.env$"; then
  echo "Error: .env is staged for commit. Remove it and use .env.example instead." >&2
  exit 1
fi

# Also scan staged file contents for common token patterns (very simple regex)
for file in $STAGED; do
  if [ -f "$file" ]; then
    if git show :"$file" | grep -E -q "(A|M|O|N)[A-Za-z0-9_-]{20,}|sk-[A-Za-z0-9]{20,}"; then
      echo "Error: Potential secret detected in staged file: $file" >&2
      echo "Please remove secrets and use environment variables or secret stores." >&2
      exit 1
    fi
  fi
done
exit 0
